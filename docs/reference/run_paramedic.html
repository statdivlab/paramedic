<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Run a Stan algorithm to estimate concentrations from combined absolute and relative abundance data — run_paramedic • paramedic</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Run a Stan algorithm to estimate concentrations from combined absolute and relative abundance data — run_paramedic" />
<meta property="og:description" content="Estimate concentrations (and efficiencies, if applicable) by combining absolute and relative abundance data." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">paramedic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/hierarchical_model_specification.html">Hierarchical model specification in `paramedic`</a>
    </li>
    <li>
      <a href="../articles/introduction_to_paramedic.html">Introduction to `paramedic`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/statdivlab/paramedic/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Run a Stan algorithm to estimate concentrations from combined absolute and relative abundance data</h1>
    <small class="dont-index">Source: <a href='https://github.com/statdivlab/paramedic/blob/master/R/run_paramedic.R'><code>R/run_paramedic.R</code></a></small>
    <div class="hidden name"><code>run_paramedic.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimate concentrations (and efficiencies, if applicable) by combining absolute and relative abundance data.</p>
    </div>

    <pre class="usage"><span class='fu'>run_paramedic</span>(
  <span class='no'>W</span>,
  <span class='no'>V</span>,
  <span class='kw'>X</span> <span class='kw'>=</span> <span class='no'>V</span>[, <span class='fl'>1</span>, <span class='kw'>drop</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>],
  <span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>n_iter</span> <span class='kw'>=</span> <span class='fl'>10500</span>,
  <span class='kw'>n_burnin</span> <span class='kw'>=</span> <span class='fl'>10000</span>,
  <span class='kw'>n_chains</span> <span class='kw'>=</span> <span class='fl'>4</span>,
  <span class='kw'>stan_seed</span> <span class='kw'>=</span> <span class='fl'>4747</span>,
  <span class='kw'>centered</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>inits_lst</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>sigma_beta</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fl'>50</span>),
  <span class='kw'>sigma_Sigma</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fl'>50</span>),
  <span class='kw'>alpha_sigma</span> <span class='kw'>=</span> <span class='fl'>2</span>,
  <span class='kw'>kappa_sigma</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>alpha_phi</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>beta_phi</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>sigma_xi</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>W</th>
      <td><p>The relative abundance data, e.g., from broad range 16S sequencing with "universal" primers. Expects data (e.g., matrix, data.frame, tibble) with sample identifiers in the first column. Sample identifiers must be the same between W and V, and the column must have the same name in W and V.</p></td>
    </tr>
    <tr>
      <th>V</th>
      <td><p>The absolute abundance data, e.g., from taxon-specific absolute primers. Expects data (e.g., matrix, data.frame, tibble) with sample identifiers in the first column. Sample identifiers must be the same between W and V, and the column must have the same name in W and V.</p></td>
    </tr>
    <tr>
      <th>X</th>
      <td><p>The covariate data. Expects data (e.g., matrix, data.frame, tibble) with sample identifiers in the first column. Sample identifiers must be the same between W, V, and X, and the column must have the same name in W, V, and X. If X only consists of the subject identifiers, then no covariates are used.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>the number of batches that the relative abundance data W were analyzed in. If k = 0 (the default), then batch effects are not considered.</p></td>
    </tr>
    <tr>
      <th>n_iter</th>
      <td><p>The total number of iterations per chain to be run by the Stan algorithm. Defaults to 10500.</p></td>
    </tr>
    <tr>
      <th>n_burnin</th>
      <td><p>The total number of warmups per chain to be run by the Stan algorithm. Defaults to 10000.</p></td>
    </tr>
    <tr>
      <th>n_chains</th>
      <td><p>The total number of chains to be run by the Stan algorithm. Defaults to 4.</p></td>
    </tr>
    <tr>
      <th>stan_seed</th>
      <td><p>The random number seed to initialize.</p></td>
    </tr>
    <tr>
      <th>centered</th>
      <td><p>If <code>TRUE</code>, uses a centered parameterization on the true concentrations \(\mu\); if <code>FALSE</code> (the default), uses a non-centered parameterization.</p></td>
    </tr>
    <tr>
      <th>inits_lst</th>
      <td><p>An optional list of initial values of the parameters. Must be a named list; see <code><a href='https://mc-stan.org/rstan/reference/stan.html'>stan</a></code>.</p></td>
    </tr>
    <tr>
      <th>sigma_beta</th>
      <td><p>Hyperparameter specifying the prior variance on \(\beta_0\). Defaults to \(\sqrt{50}\).</p></td>
    </tr>
    <tr>
      <th>sigma_Sigma</th>
      <td><p>Hyperparameter specifying the prior variance on \(\Sigma\). Defaults to \(\sqrt{50}\).</p></td>
    </tr>
    <tr>
      <th>alpha_sigma</th>
      <td><p>Hyperparameter specifying the shape parameter of the prior distribution on \(\sigma_e\). Defaults to 2.</p></td>
    </tr>
    <tr>
      <th>kappa_sigma</th>
      <td><p>Hyperparameter specifying the scale parameter of the prior distribution on \(\sigma_e\). Defaults to 1.</p></td>
    </tr>
    <tr>
      <th>alpha_phi</th>
      <td><p>Hyperparameter specifying the shape parameter of the prior distribution on \(\phi\). Defaults to 0; a negative binomial model can be specified if both <code>alpha_phi</code> and <code>beta_phi</code> are nonzero.</p></td>
    </tr>
    <tr>
      <th>beta_phi</th>
      <td><p>Hyperparameter specifying the rate parameter of the prior distribution on \(\phi\). Defaults to 0; a negative binomial model can be specified if both <code>alpha_phi</code> and <code>beta_phi</code> are nonzero.</p></td>
    </tr>
    <tr>
      <th>sigma_xi</th>
      <td><p>Hyperparameters specifying the variance of efficiencies over batches. Only used if <code>k</code> is greater than zero. Defaults to 1.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>other arguments to pass to <code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html'>sampling</a></code> (e.g., control).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>stanfit</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>We fit a hierarchical model in Stan to the data, with goal to estimate true concentration for all taxa. There are two available hierarchical models. The two only differ in the way that the true concentration is parameterized. While these hierarchical models are mathematically identical, they are fit differently by Stan. The first hierarchical model is a "centered" model, where $$\beta_0 ~ N(0, \sqrt{50})$$ $$\log \Sigma ~ N(0, \sqrt{50})$$ $$\log \mu ~ N(\beta_0 + X\beta_1, \Sigma).$$ We call this model <code>variable_efficiency_centered.stan</code>. The second hierarchical model is a "noncentered" model, where $$\beta_0 ~ N(0, \sqrt{50})$$ $$\log \Sigma ~ N(0, \sqrt{50})$$ $$\log \gamma ~ N(0, I)$$ $$\log \mu = \sqrt{\Sigma} \log \gamma + \beta_0 + X\beta_1.$$ We call this model <code>variable_efficiency.stan</code>.
In most cases, we suggest using the noncentered model. However, if the model does not converge in a reasonable amount of time using the noncentered model, consider trying the centered model.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://mc-stan.org/rstan/reference/stan.html'>stan</a></code> and <code><a href='https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html'>sampling</a></code> for specific usage of the <code>stan</code> and <code>sampling</code> functions.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># load the package, read in example data</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='st'>"paramedic"</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>example_16S_data</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>example_qPCR_data</span>)

<span class='co'># run paramedic (with an extremely small number of iterations, for illustration only)</span>
<span class='co'># on only the first 10 taxa</span>
<span class='no'>mod</span> <span class='kw'>&lt;-</span> <span class='fu'>run_paramedic</span>(<span class='kw'>W</span> <span class='kw'>=</span> <span class='no'>example_16S_data</span>[, <span class='fl'>1</span>:<span class='fl'>10</span>], <span class='kw'>V</span> <span class='kw'>=</span> <span class='no'>example_qPCR_data</span>,
<span class='kw'>n_iter</span> <span class='kw'>=</span> <span class='fl'>30</span>, <span class='kw'>n_burnin</span> <span class='kw'>=</span> <span class='fl'>25</span>, <span class='kw'>n_chains</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>stan_seed</span> <span class='kw'>=</span> <span class='fl'>4747</span>)</div><div class='output co'>#&gt; 
#&gt; SAMPLING FOR MODEL 'variable_efficiency' NOW (CHAIN 1).
#&gt; Chain 1: 
#&gt; Chain 1: Gradient evaluation took 9e-05 seconds
#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.9 seconds.
#&gt; Chain 1: Adjust your expectations accordingly!
#&gt; Chain 1: 
#&gt; Chain 1: 
#&gt; Chain 1: WARNING: There aren't enough warmup iterations to fit the
#&gt; Chain 1:          three stages of adaptation as currently configured.
#&gt; Chain 1:          Reducing each adaptation stage to 15%/75%/10% of
#&gt; Chain 1:          the given number of warmup iterations:
#&gt; Chain 1:            init_buffer = 3
#&gt; Chain 1:            adapt_window = 20
#&gt; Chain 1:            term_buffer = 2
#&gt; Chain 1: 
#&gt; Chain 1: Iteration:  1 / 30 [  3%]  (Warmup)
#&gt; Chain 1: Iteration:  3 / 30 [ 10%]  (Warmup)
#&gt; Chain 1: Iteration:  6 / 30 [ 20%]  (Warmup)
#&gt; Chain 1: Iteration:  9 / 30 [ 30%]  (Warmup)
#&gt; Chain 1: Iteration: 12 / 30 [ 40%]  (Warmup)
#&gt; Chain 1: Iteration: 15 / 30 [ 50%]  (Warmup)
#&gt; Chain 1: Iteration: 18 / 30 [ 60%]  (Warmup)
#&gt; Chain 1: Iteration: 21 / 30 [ 70%]  (Warmup)
#&gt; Chain 1: Iteration: 24 / 30 [ 80%]  (Warmup)
#&gt; Chain 1: Iteration: 26 / 30 [ 86%]  (Sampling)
#&gt; Chain 1: Iteration: 28 / 30 [ 93%]  (Sampling)
#&gt; Chain 1: Iteration: 30 / 30 [100%]  (Sampling)
#&gt; Chain 1: 
#&gt; Chain 1:  Elapsed Time: 0.008344 seconds (Warm-up)
#&gt; Chain 1:                0.001509 seconds (Sampling)
#&gt; Chain 1:                0.009853 seconds (Total)
#&gt; Chain 1: </div><div class='output co'>#&gt; <span class='warning'>Warning: There were 1 chains where the estimated Bayesian Fraction of Missing Information was low. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#bfmi-low</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Examine the pairs() plot to diagnose sampling problems</span></div><div class='output co'>#&gt; <span class='warning'>Warning: The largest R-hat is 2.5, indicating chains have not mixed.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#r-hat</span></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Brian D. Williamson, James Hughes, Amy Willis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


