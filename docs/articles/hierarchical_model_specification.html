<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hierarchical model specification in `paramedic` • paramedic</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Hierarchical model specification in `paramedic`">
<meta property="og:description" content="paramedic">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">paramedic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.3.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/hierarchical_model_specification.html">Hierarchical model specification in `paramedic`</a>
    </li>
    <li>
      <a href="../articles/introduction_to_paramedic.html">Introduction to `paramedic`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/statdivlab/paramedic/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Hierarchical model specification in
<code>paramedic</code>
</h1>
                        <h4 data-toc-skip class="author">Brian D.
Williamson and Amy D. Willis</h4>
            
            <h4 data-toc-skip class="date">2024-05-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/statdivlab/paramedic/blob/HEAD/vignettes/hierarchical_model_specification.Rmd" class="external-link"><code>vignettes/hierarchical_model_specification.Rmd</code></a></small>
      <div class="hidden name"><code>hierarchical_model_specification.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>paramedic</code> jointly models two data types: relative
abundance data (e.g., 16S data), and absolute abundance data (e.g., qPCR
data). Importantly, the model accounts for the fact that taxa may be
detected with differing efficiency across the two datatypes. In <a href="https://www.biorxiv.org/content/10.1101/761486v1" class="external-link">the paper</a>,
we describe a hierarchical model that can be used in the absence of
sample covariates or batch covariates. However, many users are likely to
have covariate data available to improve modelling. The purpose of this
vignette is to show you how to customise <code>paramedic</code> to
incorporate your covariate data and batch data. We also discuss how to
modify the absolute abundance data’s generating process from Poisson to
Negative Binomial. In all examples below, we use the example data
referenced in the <a href="introduction_to_paramedic.html">main
vignette</a>. Additionally, we use a very small number of total and
burn-in iterations for illustration only; we stress that a larger number
of iterations should be used in practice.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://mc-stan.org/rstan/" class="external-link">"rstan"</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: package 'rstan' was built under R version 4.3.2</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: StanHeaders</span></span></code></pre>
<pre><code><span><span class="co">## Warning: package 'StanHeaders' was built under R version 4.3.2</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## rstan version 2.32.5 (Stan version 2.32.2)</span></span></code></pre>
<pre><code><span><span class="co">## For execution on a local, multicore CPU with excess RAM we recommend calling</span></span>
<span><span class="co">## options(mc.cores = parallel::detectCores()).</span></span>
<span><span class="co">## To avoid recompilation of unchanged Stan programs, we recommend calling</span></span>
<span><span class="co">## rstan_options(auto_write = TRUE)</span></span>
<span><span class="co">## For within-chain threading using `reduce_sum()` or `map_rect()` Stan functions,</span></span>
<span><span class="co">## change `threads_per_chain` option:</span></span>
<span><span class="co">## rstan_options(threads_per_chain = 1)</span></span></code></pre>
<pre><code><span><span class="co">## Do not specify '-march=native' in 'LOCAL_CPPFLAGS' or a Makevars file</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://statdivlab.github.io/paramedic">"paramedic"</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Rcpp</span></span></code></pre>
<pre><code><span><span class="co">## paramedic version 0.1.3.5: Predicting Absolute and Relative Abundance by Modeling</span></span>
<span><span class="co">## Efficiency to Derive Intervals and Concentrations</span></span></code></pre>
<pre><code><span><span class="co">## Package created on 2023-12-26</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: package 'dplyr' was built under R version 4.3.2</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">example_16S_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">example_qPCR_data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="hierarchical-models-currently-available-in-paramedic">Hierarchical models currently available in
<code>paramedic</code><a class="anchor" aria-label="anchor" href="#hierarchical-models-currently-available-in-paramedic"></a>
</h2>
<div class="section level3">
<h3 id="the-default-hierarchical-model">The default hierarchical model<a class="anchor" aria-label="anchor" href="#the-default-hierarchical-model"></a>
</h3>
<p>The default hierarchical model in <code>paramedic</code> places a
Poisson distribution on <span class="math inline">\(V\)</span> and a
multinomial distribution on <span class="math inline">\(W\)</span>; a
normal distribution on <span class="math inline">\(\log \mu\)</span>,
where the distribution depends on a taxon-specific intercept <span class="math inline">\(\beta_0\)</span> and a covariance matrix <span class="math inline">\(\Sigma\)</span>; and a normal distribution on
<span class="math inline">\(\log e\)</span>. The likelihood is (for all
<span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>): <span class="math display">\[V_{ij}
\mid \mu_{ij} \sim Poisson(\mu_{ij}) \\ p_{ij} =
\frac{\mu_{ij}e_j}{\sum_{\ell = 1}^q \mu_{i\ell}e_\ell} \\ W_{i\cdot}
\mid M_i, \mu_{i\cdot}, e \sim Multinomial(M_i,
p_{i\cdot}).\]</span></p>
<p>We place the following priors on <span class="math inline">\(\mu\)</span> and <span class="math inline">\(e\)</span>: <span class="math display">\[\log\mu_{i\cdot} \sim N_q(\beta_0, \Sigma) \\
\beta_0 \sim N_q(0, \sigma^2_\beta) \\ \Sigma_{jj} \sim Lognormal(0,
\sigma^2_\Sigma) \\ e_j \sim Lognormal(0, \sigma^2_e) \\ \sigma^2_e \sim
InvGamma(\alpha_\sigma, \kappa_\sigma).\]</span></p>
<p>The following code fits this model in <code>paramedic</code> for the
example data:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">paramedic</span><span class="fu">::</span><span class="fu"><a href="../reference/run_paramedic.html">run_paramedic</a></span><span class="op">(</span>W <span class="op">=</span> <span class="va">example_16S_data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>, V <span class="op">=</span> <span class="va">example_qPCR_data</span>,</span>
<span>                                n_iter <span class="op">=</span> <span class="fl">30</span>, n_burnin <span class="op">=</span> <span class="fl">25</span>, n_chains <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                stan_seed <span class="op">=</span> <span class="fl">4747</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_treedepth <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="allowing-for-covariates">Allowing for covariates<a class="anchor" aria-label="anchor" href="#allowing-for-covariates"></a>
</h3>
<p>It may be of interest to allow covariates to affect the mean for each
taxon. In this case, we may replace the prior on <span class="math inline">\(\mu\)</span> with the following: <span class="math display">\[\log\mu_{i\cdot} \sim N_q(\beta_0 + X_i\beta_1,
\Sigma) \\ \beta_0 \sim N_q(0, \sigma^2_\beta) \\ \beta_{1,k} \sim
N_q(0, 1),\]</span> where <span class="math inline">\(\beta_1\)</span>
is a matrix with number of rows equal to the number of covariates and
number of columns equal to <span class="math inline">\(q\)</span>.</p>
<p>You can implement this model by passing a tibble of covariates <span class="math inline">\(X\)</span> to <code>run_paramedic</code>. <span class="math inline">\(X\)</span> must have number of rows equal to the
sample size, and any number of columns.</p>
<p>Suppose that we have a binary variable that specifies case status
(i.e., 1 denotes a case and 0 denotes a control) for some disease. For
example,</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate a random case/control status variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4747</span><span class="op">)</span></span>
<span><span class="va">case_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">example_qPCR_data</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tibble.tidyverse.org/" class="external-link">"tibble"</a></span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>sample_id <span class="op">=</span> <span class="va">example_qPCR_data</span><span class="op">$</span><span class="va">sample_id</span>, case <span class="op">=</span> <span class="va">case_control</span><span class="op">)</span></span></code></pre></div>
<p>If we want to adjust for this covariate in the example data analysis
using <code>paramedic</code>, we use the following code:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_with_covariates</span> <span class="op">&lt;-</span> <span class="fu">paramedic</span><span class="fu">::</span><span class="fu"><a href="../reference/run_paramedic.html">run_paramedic</a></span><span class="op">(</span>W <span class="op">=</span> <span class="va">example_16S_data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>,</span>
<span>                                                V <span class="op">=</span> <span class="va">example_qPCR_data</span>, X <span class="op">=</span> <span class="va">X</span>,</span>
<span>                                                n_iter <span class="op">=</span> <span class="fl">30</span>, n_burnin <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                                                n_chains <span class="op">=</span> <span class="fl">1</span>, stan_seed <span class="op">=</span> <span class="fl">4747</span>,</span>
<span>                                                control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_treedepth <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="allowing-for-potential-overdispersion-in-v">Allowing for potential overdispersion in <span class="math inline">\(V\)</span><a class="anchor" aria-label="anchor" href="#allowing-for-potential-overdispersion-in-v"></a>
</h3>
<p>It may be of interest to allow for overdispersion in <span class="math inline">\(V\)</span>. In this case, we may replace the
likelihood on <span class="math inline">\(V\)</span> with the following:
<span class="math display">\[V_{ij} \sim NegBin(\mu_{ij},
\phi_i),\]</span> where <span class="math inline">\(\phi_i\)</span> is a
subject-specific overdispersion parameter. We add the following prior on
<span class="math inline">\(\phi\)</span>: for all <span class="math inline">\(i\)</span>, <span class="math display">\[\phi_i
\sim Gamma(\alpha_\phi, \beta_\phi).\]</span></p>
<p>You can implement this model by passing nonzero values of
<code>alpha_phi</code> and <code>beta_phi</code> to
<code>run_paramedic</code>.</p>
<p>In the example data, we can run the following code to implement this
analysis:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">paramedic</span><span class="fu">::</span><span class="fu"><a href="../reference/run_paramedic.html">run_paramedic</a></span><span class="op">(</span>W <span class="op">=</span> <span class="va">example_16S_data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>, V <span class="op">=</span> <span class="va">example_qPCR_data</span>,</span>
<span>                                alpha_phi <span class="op">=</span> <span class="fl">1</span>, beta_phi <span class="op">=</span> <span class="fl">10</span>, n_iter <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                                n_burnin <span class="op">=</span> <span class="fl">25</span>, n_chains <span class="op">=</span> <span class="fl">1</span>, stan_seed <span class="op">=</span> <span class="fl">4747</span>,</span>
<span>                                control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_treedepth <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="allowing-for-batch-covariates">Allowing for batch covariates<a class="anchor" aria-label="anchor" href="#allowing-for-batch-covariates"></a>
</h3>
<p>In some cases, the data under consideration are collected in multiple
experiments (or batches). Here, we could add a layer to the hierarchical
model to describe this data-generating mechanism. For example, if <span class="math inline">\(i\)</span> indexes the sample, <span class="math inline">\(j\)</span> indexes the taxon, and <span class="math inline">\(k\)</span> indexes the study (or batch), the
efficiencies could be modeled as <span class="math display">\[e_{jk}
\sim Lognormal(\xi_j, \sigma^2_\xi) \\ \xi_j \sim Lognormal(0,
\sigma^2_e)\]</span> in order that each taxon’s efficiency in each
experiment can vary around an overall efficiency for that taxon.</p>
<p>Suppose that in the example data, we had replicates from multiple
batches. For example,</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate technical replicates</span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span></span>
<span><span class="va">W_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">example_16S_data</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">example_16S_data</span><span class="op">)</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">V_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">example_qPCR_data</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">example_qPCR_data</span><span class="op">)</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">W_replicate</span> <span class="op">&lt;-</span> <span class="va">example_16S_data</span></span>
<span><span class="va">W_replicate</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">W_replicate</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">W_diff</span><span class="op">)</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">example_16S_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>batch <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">W_replicate</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>batch <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">V_replicate</span> <span class="op">&lt;-</span> <span class="va">example_qPCR_data</span></span>
<span><span class="va">V_replicate</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">V_replicate</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">V_diff</span><span class="op">)</span></span>
<span><span class="va">V</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">example_qPCR_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>batch <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">V_replicate</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>batch <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can run the following code to implement this analysis:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_batches</span> <span class="op">&lt;-</span> <span class="fu">paramedic</span><span class="fu">::</span><span class="fu"><a href="../reference/run_paramedic.html">run_paramedic</a></span><span class="op">(</span>W <span class="op">=</span> <span class="va">W</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">434</span><span class="op">)</span><span class="op">]</span>, V <span class="op">=</span> <span class="va">V</span>, </span>
<span>                                        k <span class="op">=</span> <span class="va">K</span>, sigma_beta <span class="op">=</span> <span class="va">sigma_beta</span>, </span>
<span>                                        sigma_Sigma <span class="op">=</span> <span class="va">sigma_Sigma</span>, </span>
<span>                                        alpha_sigma <span class="op">=</span> <span class="va">alpha_sigma</span>, </span>
<span>                                        kappa_sigma <span class="op">=</span> <span class="va">kappa_sigma</span>, </span>
<span>                                        n_iter <span class="op">=</span> <span class="fl">50</span>, n_burnin <span class="op">=</span> <span class="fl">30</span>, </span>
<span>                                        n_chains <span class="op">=</span> <span class="fl">1</span>, stan_seed <span class="op">=</span> <span class="fl">4747</span>, </span>
<span>                                        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.9</span>, </span>
<span>                                                       max_treedepth <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="requesting-new-hierarchical-modeling-options">Requesting new hierarchical modeling options<a class="anchor" aria-label="anchor" href="#requesting-new-hierarchical-modeling-options"></a>
</h2>
<p>If you would like to see a new hierarchical modeling choice in
<code>paramedic</code>, please do one of the following:</p>
<ol style="list-style-type: decimal">
<li>
<a href="https://github.com/statdivlab/paramedic/issues" class="external-link">File an
issue</a> specifying exactly the distribution that you would like to be
added to <code>paramedic</code> (i.e., provide the mathematical formula
and describe all parameters/hyperparameters). Please state your
justification for requesting this distribution.</li>
<li>Create a pull request after modifying the following files: update
<code>src/stan/variable_efficiency.stan</code> and
<code>src/stan/variable_efficiency_centered.stan</code> by adding the
new option (please follow the style already implemented for various
options); then update <code>R/run_paramedic.R</code> with any new
arguments that are required.</li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Brian D. Williamson, James Hughes, Amy Willis.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
