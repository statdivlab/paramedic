<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Predicting Absolute and Relative Abundance by Modeling Efficiency to Derive Intervals and Concentrations • paramedic</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Predicting Absolute and Relative Abundance by Modeling Efficiency to Derive Intervals and Concentrations">
<meta property="og:description" content="We estimate microbial abundances by combining compositional abundance data and observed absolute abundance data. We have two fully Bayesian hierarchical models allowing for varying efficiencies. The two models only differ in the way that the true concentration is parameterized: the first uses a centered parameterization, while the second uses a noncentered parameterization. There may be differences in speed and accuracy of each hierarchical model, depending on the dataset and initial values chosen. Please read any warning messages returned by the algorithm carefully, as these can help diagnose convergence issues. We return credible intervals and point estimates for the true concentrations, and point estimates and prediction intervals for the unobserved absolute abundances.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">paramedic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/hierarchical_model_specification.html">Hierarchical model specification in `paramedic`</a>
    </li>
    <li>
      <a href="articles/introduction_to_paramedic.html">Introduction to paramedic</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/statdivlab/paramedic/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="rparamedic-predicting-absolute-and-relative-abundance-by-modeling-efficiency-to-derive-intervals-and-concentrations-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#rparamedic-predicting-absolute-and-relative-abundance-by-modeling-efficiency-to-derive-intervals-and-concentrations-" class="anchor"></a><code>R/paramedic</code>: Predicting Absolute and Relative Abundance by Modeling Efficiency to Derive Intervals and Concentrations <img src="reference/figures/paramedic-logo.png" align="right" width="165px">
</h1></div>

<p><strong>Software author:</strong> <a href="https://bdwilliamson.github.io/">Brian Williamson</a></p>
<p><strong>Methodology authors:</strong> <a href="https://bdwilliamson.github.io/">Brian Williamson</a>, <a href="http://faculty.washington.edu/jphughes/">Jim Hughes</a> and <a href="http://statisticaldiversitylab.com/team/amy-willis">Amy Willis</a></p>
<hr>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><code>paramedic</code> is a R package for estimating microbial concentration. <code>paramedic</code> uses information from 16S count data (compositional data on all taxa) and absolute data on a subset of taxa (e.g., qPCR or flow cytometry) to estimate the absolute abundance of all taxa. The method accounts for differing taxon detection efficiencies between the two methods, and produces prediction and confidence intervals as well as point estimates of the absolute abundance of all taxa. Check out <a href="https://www.biorxiv.org/content/10.1101/761486v1">the paper</a> for more details.</p>
<hr>
</div>
<div id="r-installation" class="section level2">
<h2 class="hasAnchor">
<a href="#r-installation" class="anchor"></a>R installation</h2>
<p>You may install a stable release of <code>paramedic</code> from GitHub via <a href="https://www.rstudio.com/products/rpackages/devtools/"><code>devtools</code></a> by running the following code (replace <code>v0.1.0</code> with the tag for the specific release you wish to install, and only install <code>devtools</code> if needed):</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="kw">repo</span> <span class="kw">=</span> <span class="st">"statdivlab/paramedic@v0.1.0"</span>)</pre></div>
<p>You may install a development release of <code>paramedic</code> from GitHub via <a href="https://www.rstudio.com/products/rpackages/devtools/"><code>devtools</code></a> by running the following code:</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="kw">repo</span> <span class="kw">=</span> <span class="st">"statdivlab/paramedic"</span>)</pre></div>
<hr>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>This example shows how to use <code>paramedic</code> in a simple setting with data inspired by the University of Washington (UW) Sexually Transmitted Infections Cooperative Research Center (STICRC). For more examples and detailed explanation, please see the <a href="https://statdivlab.github.io/paramedic/introduction_to_paramedic.html">vignette</a>.</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="co">## load required functions and libraries</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"rstan"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"paramedic"</span>)

<span class="co">## read in the data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">example_16S_data</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">example_qPCR_data</span>)

<span class="co"># sample hyperparameter values</span>
<span class="no">sigma_beta</span> <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">sigma_Sigma</span> <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">alpha_sigma</span> <span class="kw">&lt;-</span> <span class="fl">2</span>
<span class="no">kappa_sigma</span> <span class="kw">&lt;-</span> <span class="fl">1</span>

<span class="co">## -------------------------------------------------------------</span>
<span class="co">## Estimate concentrations for the first 7 taxa</span>
<span class="co">## -------------------------------------------------------------</span>
<span class="co">## this is a small number of iterations, only for illustration</span>
<span class="co">## also, shows how to use control parameters for rstan::stan</span>
<span class="no">stan_mod</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/run_paramedic.html">run_paramedic</a></span>(<span class="kw">W</span> <span class="kw">=</span> <span class="no">example_16S_data</span>[, <span class="fl">1</span>:<span class="fl">10</span>], <span class="kw">V</span> <span class="kw">=</span> <span class="no">example_qPCR_data</span>,
                      <span class="kw">sigma_beta</span> <span class="kw">=</span> <span class="no">sigma_beta</span>, <span class="kw">sigma_Sigma</span> <span class="kw">=</span> <span class="no">sigma_Sigma</span>,
                      <span class="kw">alpha_sigma</span> <span class="kw">=</span> <span class="no">alpha_sigma</span>, <span class="kw">kappa_sigma</span> <span class="kw">=</span> <span class="no">kappa_sigma</span>,
                      <span class="kw">n_iter</span> <span class="kw">=</span> <span class="fl">30</span>, <span class="kw">n_burnin</span> <span class="kw">=</span> <span class="fl">25</span>, <span class="kw">n_chains</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">stan_seed</span> <span class="kw">=</span> <span class="fl">4747</span>,
                      <span class="kw">control</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">adapt_delta</span> <span class="kw">=</span> <span class="fl">0.85</span>, <span class="kw">max_treedepth</span> <span class="kw">=</span> <span class="fl">15</span>),
                      <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">stan_mod_summ</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">stan_mod</span>, <span class="kw">probs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))$<span class="no">summary</span>
<span class="no">stan_mod_samps</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rstan/man/stanfit-method-extract.html">extract</a></span>(<span class="no">stan_mod</span>)

<span class="co">## -------------------------------------------------------------</span>
<span class="co">## Extract posterior estimates for the taxon missing abolute abundance data</span>
<span class="co">## -------------------------------------------------------------</span>
<span class="no">posterior_summaries</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/extract_posterior_summaries.html">extract_posterior_summaries</a></span>(<span class="no">stan_mod_summ</span>, <span class="no">stan_mod_samps</span>,
                                                   <span class="kw">taxa_of_interest</span> <span class="kw">=</span> <span class="fl">9</span>, <span class="kw">mult_num</span> <span class="kw">=</span> <span class="fl">1</span>,
                                                   <span class="kw">level</span> <span class="kw">=</span> <span class="fl">0.95</span>, <span class="kw">interval_type</span> <span class="kw">=</span> <span class="st">"wald"</span>)

<span class="co">## -------------------------------------------------------------</span>
<span class="co">## Print out the posterior mean efficiencies and concentrations</span>
<span class="co">## -------------------------------------------------------------</span>
<span class="no">posterior_summaries</span>$<span class="no">estimates</span>
<span class="no">posterior_summaries</span>$<span class="no">est_efficiency</span></pre></div>
<hr>
</div>
<div id="citation" class="section level2">
<h2 class="hasAnchor">
<a href="#citation" class="anchor"></a>Citation</h2>
<p>After using the <code>paramedic</code> package, please cite the following:</p>
<pre><code>  @article{williamson2020,
    author={Williamson, BD and Hughes, JP and Willis, AD},
    title={A multi-view model for relative and absolute microbial abundances},
    journal={bioRxiv},
    year={2020},
    note={doi: https://doi.org/10.1101/761486}
  }</code></pre>
<hr>
</div>
<div id="issues" class="section level2">
<h2 class="hasAnchor">
<a href="#issues" class="anchor"></a>Issues</h2>
<p>We use Stan to fit the hierarchical model to the data. Read any warning messages returned by the algorithm carefully, as these can help diagnose convergence issues. Carefully choosing initialisation values can speed up convergence.</p>
<p>If you encounter any bugs or have any specific feature requests, please <a href="https://github.com/statdivlab/paramedic/issues">file an issue</a>. If your feature request relates to the hierarchical models implemented in <code>paramedic</code>, please read <a href="https://statdivlab.github.io/paramedic/hierarchical_model_specification.html">the hierarchical models vignette</a> prior to filing an issue or creating a pull request.</p>
<hr>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/statdivlab/paramedic/">https://​github.com/​statdivlab/​paramedic/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/statdivlab/paramedic/issues">https://​github.com/​statdivlab/​paramedic/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/BSD-3-Clause">BSD_3_clause</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Brian D. Williamson <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-7024-548X" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>James Hughes <br><small class="roles"> Author </small>  </li>
<li>Amy Willis <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-2802-4317" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/statdivlab/paramedic"><img src="https://travis-ci.org/statdivlab/paramedic.svg?branch=master" alt="Build Status"></a></li>
<li><a href="https://codecov.io/gh/statdivlab/paramedic"><img src="https://codecov.io/gh/statdivlab/paramedic/branch/master/graph/badge.svg?token=GnLFG7QNsh" alt="codecov"></a></li>
<li><a href="https://opensource.org/licenses/BSD-3-Clause"><img src="https://img.shields.io/badge/License-BSD--3--Clause-yellow" alt="License: BSD-3"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Brian D. Williamson, James Hughes, Amy Willis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
